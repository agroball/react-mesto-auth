{"ast":null,"code":"import _toConsumableArray from\"/home/timakov/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/timakov/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import'../index.css';import Header from'./Header.js';import Main from'./Main.js';import Login from'./Login.js';import Register from'./Register';import PopupWithForm from'./PopupWithForm.js';import ImagePopup from'./ImagePopup.js';import{CurrentUserContext}from'../contexts/CurrentUserContext';import api from'../utils/api.js';import*as Auth from'../utils/auth';import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup\";import ProtectedRoute from\"./ProtectedRoute\";import InfoTooltip from\"./InfoToolTip\";import React from\"react\";import RegOk from\"../images/registration-ok.svg\";import RegNoOK from\"../images/login-fail.svg\";import{Route,Switch,Redirect,useHistory}from\"react-router-dom\";import Footer from\"./Footer\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditAvatarPopupOpen=_React$useState2[0],setIsEditAvatarPopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isAddPlacePopupOpen=_React$useState4[0],setIsAddPlacePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditProfilePopupOpen=_React$useState6[0],setIsEditProfilePopupOpen=_React$useState6[1];var _React$useState7=React.useState({}),_React$useState8=_slicedToArray(_React$useState7,2),selectedCard=_React$useState8[0],setSelectedCard=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isPopupWithImageOpen=_React$useState10[0],setIsPopupWithImageOpen=_React$useState10[1];var _React$useState11=React.useState([]),_React$useState12=_slicedToArray(_React$useState11,2),cards=_React$useState12[0],setCards=_React$useState12[1];var _React$useState13=React.useState({name:'',about:''}),_React$useState14=_slicedToArray(_React$useState13,2),currentUser=_React$useState14[0],setCurrentUser=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),isInfoTooltipPopupOpen=_React$useState16[0],setIsInfoTooltipPopupOpen=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),loggedIn=_React$useState18[0],setLoggedIn=_React$useState18[1];var _React$useState19=React.useState({iconPath:'',text:''}),_React$useState20=_slicedToArray(_React$useState19,2),message=_React$useState20[0],setMessage=_React$useState20[1];var _React$useState21=React.useState(''),_React$useState22=_slicedToArray(_React$useState21,2),email=_React$useState22[0],setEmail=_React$useState22[1];var history=useHistory();React.useEffect(function(){var jwt=localStorage.getItem('jwt');if(jwt){Auth.getContent(jwt).then(function(res){setLoggedIn(true);setEmail(res.data.email);history.push('/');}).catch(function(err){return console.log(err);});}},[history]);React.useEffect(function(){var promises=[api.getUserInfo(),api.getInitialCards()];Promise.all(promises).then(function(_ref){var _ref2=_slicedToArray(_ref,2),user=_ref2[0],cards=_ref2[1];console.log(user,cards);setCurrentUser(user);setCards(cards);}).catch(function(error){console.log(error);});},[]);function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function handleInfoTooltipPopupOpen(){setIsInfoTooltipPopupOpen(true);}function handleInfoTooltipContent(_ref3){var iconPath=_ref3.iconPath,text=_ref3.text;setMessage({iconPath:iconPath,text:text});}function handleCardClick(card){setSelectedCard(card);setIsPopupWithImageOpen(true);}function closeAllPopups(){setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setIsEditAvatarPopupOpen(false);setSelectedCard({});setIsPopupWithImageOpen(false);setIsInfoTooltipPopupOpen(false);}function handleLikeClick(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\napi.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){// Формируем новый массив на основе имеющегося, подставляя в него новую карточку\nvar newCards=cards.map(function(c){return c._id===card._id?newCard:c;});// Обновляем стейт\nsetCards(newCards);}).catch(function(err){return console.log(err);});}function handleDeleteClick(card){api.deleteCard(card._id).then(function(newCard){var newCards=cards.filter(function(c){return c._id===card._id?\"\":newCard;});setCards(newCards);}).catch(function(err){return console.log(err);});}function handleUpdateUser(_ref4){var name=_ref4.name,about=_ref4.about;return api.setUserInfo(name,about).then(function(result){setCurrentUser(result);closeAllPopups();}).catch(function(err){return console.log(err);});}function handleUpdateAvatar(data){api.updateAvatarImage(data).then(function(result){setCurrentUser(result);closeAllPopups();}).catch(function(err){return console.log(err);});}function handleAddPlaceSubmit(_ref5){var name=_ref5.name,link=_ref5.link;api.addCard(name,link).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){return console.log(err);});}// Регистрация\nfunction registration(email,password){Auth.register(email,password).then(function(res){if(res.status===201){handleInfoTooltipContent({iconPath:RegOk,text:'Вы успешно зарегистрировались!'});handleInfoTooltipPopupOpen();// Перенаправляем на страницу логина спустя 3сек и закрываем попап\nsetTimeout(history.push,3000,\"/sign-in\");setTimeout(closeAllPopups,2500);}if(res.status===400){console.log('Введный емейл ужезарегестрирован');}}).catch(function(err){handleInfoTooltipContent({iconPath:RegNoOK,text:'Что-то пошло не так! Попробуйте ещё раз.'});handleInfoTooltipPopupOpen();setTimeout(closeAllPopups,2500);console.log(err);});}// Авторизация\nfunction authorization(email,password){Auth.authorize(email,password).then(function(data){if(!data){throw new Error('Произошла ошибка');}Auth.getContent(data).then(function(res){setEmail(res.data.email);}).catch(function(err){return console.log(err);});setLoggedIn(true);handleInfoTooltipContent({iconPath:RegOk,text:'Вы успешно авторизовались!'});handleInfoTooltipPopupOpen();// Перенаправляем на главную страницу спустя 3сек и закрываем попап\nsetTimeout(history.push,3000,\"/\");setTimeout(closeAllPopups,2500);}).catch(function(err){handleInfoTooltipContent({iconPath:RegNoOK,text:'Что то пошло не так! Попробуйте еще раз!'});handleInfoTooltipPopupOpen();console.log(err);});}// Выход из учетки\nfunction handleSignOut(){setLoggedIn(false);localStorage.removeItem('jwt');setEmail('');history.push('/sign-in');}return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,email:email,handleSignOut:handleSignOut}),/*#__PURE__*/_jsxs(Switch,{children:[currentUser&&/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,component:Main,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,onCardClick:handleCardClick,cards:cards,onCardLike:handleLikeClick,onCardDelete:handleDeleteClick}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Login,{authorization:authorization})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Register,{registration:registration})}),/*#__PURE__*/_jsx(Route,{path:\"/\",children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/sign-in\"})})]}),loggedIn&&/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(PopupWithForm,{name:\"agreePopup\",title:\"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",button:\"\\u0414\\u0430\"}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,isOpen:isPopupWithImageOpen,onClose:closeAllPopups}),currentUser&&/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipPopupOpen,onClose:closeAllPopups,message:message})]})});}export default App;","map":{"version":3,"sources":["/home/timakov/react-mesto-auth/src/components/App.js"],"names":["Header","Main","Login","Register","PopupWithForm","ImagePopup","CurrentUserContext","api","Auth","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ProtectedRoute","InfoTooltip","React","Route","Switch","Redirect","useHistory","Footer","App","useState","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditProfilePopupOpen","setIsEditProfilePopupOpen","selectedCard","setSelectedCard","isPopupWithImageOpen","setIsPopupWithImageOpen","cards","setCards","name","about","currentUser","setCurrentUser","isInfoTooltipPopupOpen","setIsInfoTooltipPopupOpen","loggedIn","setLoggedIn","iconPath","text","message","setMessage","email","setEmail","history","useEffect","jwt","localStorage","getItem","getContent","then","res","data","push","catch","err","console","log","promises","getUserInfo","getInitialCards","Promise","all","user","error","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleInfoTooltipPopupOpen","handleInfoTooltipContent","handleCardClick","card","closeAllPopups","handleLikeClick","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","newCards","map","c","handleDeleteClick","deleteCard","filter","handleUpdateUser","setUserInfo","result","handleUpdateAvatar","updateAvatarImage","handleAddPlaceSubmit","link","addCard","registration","password","register","status","RegOk","setTimeout","RegNoOK","authorization","authorize","Error","handleSignOut","removeItem"],"mappings":"0OAAA,MAAO,cAAP,CACA,MAAOA,CAAAA,MAAP,KAAmB,aAAnB,CACA,MAAOC,CAAAA,IAAP,KAAiB,WAAjB,CACA,MAAOC,CAAAA,KAAP,KAAkB,YAAlB,CACA,MAAOC,CAAAA,QAAP,KAAqB,YAArB,CACA,MAAOC,CAAAA,aAAP,KAA0B,oBAA1B,CACA,MAAOC,CAAAA,UAAP,KAAuB,iBAAvB,CACA,OAASC,kBAAT,KAAmC,gCAAnC,CACA,MAAOC,CAAAA,GAAP,KAAgB,iBAAhB,CACA,MAAO,GAAKC,CAAAA,IAAZ,KAAsB,eAAtB,CACA,MAAOC,CAAAA,gBAAP,KAA6B,oBAA7B,CACA,MAAOC,CAAAA,eAAP,KAA4B,mBAA5B,CACA,MAAOC,CAAAA,aAAP,KAA0B,iBAA1B,CACA,MAAOC,CAAAA,cAAP,KAA2B,kBAA3B,CACA,MAAOC,CAAAA,WAAP,KAAwB,eAAxB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,C,+FAGA,OAASC,KAAT,CAAgBC,MAAhB,CAAwBC,QAAxB,CAAkCC,UAAlC,KAAoD,kBAApD,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,C,6IAGA,QAASC,CAAAA,GAAT,EAAe,qBAE+CN,KAAK,CAACO,QAAN,CAAe,KAAf,CAF/C,oDAEJC,qBAFI,qBAEmBC,wBAFnB,0CAG2CT,KAAK,CAACO,QAAN,CAAe,KAAf,CAH3C,qDAGJG,mBAHI,qBAGiBC,sBAHjB,0CAIiDX,KAAK,CAACO,QAAN,CAAe,KAAf,CAJjD,qDAIJK,sBAJI,qBAIoBC,yBAJpB,0CAK6Bb,KAAK,CAACO,QAAN,CAAe,EAAf,CAL7B,qDAKJO,YALI,qBAKUC,eALV,0CAM6Cf,KAAK,CAACO,QAAN,CAAe,KAAf,CAN7C,sDAMJS,oBANI,sBAMkBC,uBANlB,4CAOejB,KAAK,CAACO,QAAN,CAAe,EAAf,CAPf,uDAOJW,KAPI,sBAOGC,QAPH,4CAQ2BnB,KAAK,CAACO,QAAN,CAAe,CAAEa,IAAI,CAAE,EAAR,CAAYC,KAAK,CAAE,EAAnB,CAAf,CAR3B,uDAQJC,WARI,sBAQSC,cART,4CASiDvB,KAAK,CAACO,QAAN,CAAe,KAAf,CATjD,uDASJiB,sBATI,sBASoBC,yBATpB,4CAUqBzB,KAAK,CAACO,QAAN,CAAe,KAAf,CAVrB,uDAUJmB,QAVI,sBAUMC,WAVN,4CAWmB3B,KAAK,CAACO,QAAN,CAAe,CAAEqB,QAAQ,CAAE,EAAZ,CAAgBC,IAAI,CAAE,EAAtB,CAAf,CAXnB,uDAWJC,OAXI,sBAWKC,UAXL,4CAYe/B,KAAK,CAACO,QAAN,CAAe,EAAf,CAZf,uDAYJyB,KAZI,sBAYGC,QAZH,sBAaX,GAAMC,CAAAA,OAAO,CAAG9B,UAAU,EAA1B,CAEAJ,KAAK,CAACmC,SAAN,CAAgB,UAAM,CAClB,GAAMC,CAAAA,GAAG,CAAGC,YAAY,CAACC,OAAb,CAAqB,KAArB,CAAZ,CACA,GAAIF,GAAJ,CAAS,CACL1C,IAAI,CAAC6C,UAAL,CAAgBH,GAAhB,EACKI,IADL,CACU,SAACC,GAAD,CAAS,CACXd,WAAW,CAAC,IAAD,CAAX,CACAM,QAAQ,CAACQ,GAAG,CAACC,IAAJ,CAASV,KAAV,CAAR,CACAE,OAAO,CAACS,IAAR,CAAa,GAAb,EACH,CALL,EAMKC,KANL,CAMW,SAAAC,GAAG,QAAIC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAJ,EANd,EAOH,CACJ,CAXD,CAWG,CAACX,OAAD,CAXH,EAcAlC,KAAK,CAACmC,SAAN,CAAgB,UAAM,CAClB,GAAMa,CAAAA,QAAQ,CAAG,CAACvD,GAAG,CAACwD,WAAJ,EAAD,CAAoBxD,GAAG,CAACyD,eAAJ,EAApB,CAAjB,CACAC,OAAO,CAACC,GAAR,CAAYJ,QAAZ,EACKR,IADL,CACU,cAAmB,kCAAjBa,IAAiB,UAAXnC,KAAW,UACrB4B,OAAO,CAACC,GAAR,CAAYM,IAAZ,CAAkBnC,KAAlB,EACAK,cAAc,CAAC8B,IAAD,CAAd,CACAlC,QAAQ,CAACD,KAAD,CAAR,CACH,CALL,EAMK0B,KANL,CAMW,SAACU,KAAD,CAAW,CACdR,OAAO,CAACC,GAAR,CAAYO,KAAZ,EACH,CARL,EASH,CAXD,CAWG,EAXH,EAaA,QAASC,CAAAA,sBAAT,EAAkC,CAC9B1C,yBAAyB,CAAC,IAAD,CAAzB,CACH,CAED,QAAS2C,CAAAA,mBAAT,EAA8B,CAC1B7C,sBAAsB,CAAC,IAAD,CAAtB,CACH,CAED,QAAS8C,CAAAA,qBAAT,EAAiC,CAC7BhD,wBAAwB,CAAC,IAAD,CAAxB,CACH,CAED,QAASiD,CAAAA,0BAAT,EAAsC,CAClCjC,yBAAyB,CAAC,IAAD,CAAzB,CACH,CACD,QAASkC,CAAAA,wBAAT,OAAoD,IAAjB/B,CAAAA,QAAiB,OAAjBA,QAAiB,CAAPC,IAAO,OAAPA,IAAO,CAChDE,UAAU,CAAC,CAAEH,QAAQ,CAAEA,QAAZ,CAAsBC,IAAI,CAAEA,IAA5B,CAAD,CAAV,CACH,CAED,QAAS+B,CAAAA,eAAT,CAAyBC,IAAzB,CAA+B,CAC3B9C,eAAe,CAAC8C,IAAD,CAAf,CACA5C,uBAAuB,CAAC,IAAD,CAAvB,CACH,CAED,QAAS6C,CAAAA,cAAT,EAA0B,CACtBjD,yBAAyB,CAAC,KAAD,CAAzB,CACAF,sBAAsB,CAAC,KAAD,CAAtB,CACAF,wBAAwB,CAAC,KAAD,CAAxB,CACAM,eAAe,CAAC,EAAD,CAAf,CACAE,uBAAuB,CAAC,KAAD,CAAvB,CACAQ,yBAAyB,CAAC,KAAD,CAAzB,CACH,CAED,QAASsC,CAAAA,eAAT,CAAyBF,IAAzB,CAA+B,CAC3B,GAAMG,CAAAA,OAAO,CAAGH,IAAI,CAACI,KAAL,CAAWC,IAAX,CAAgB,SAACC,CAAD,QAAOA,CAAAA,CAAC,CAACC,GAAF,GAAU9C,WAAW,CAAC8C,GAA7B,EAAhB,CAAhB,CACA;AACA3E,GAAG,CAAC4E,oBAAJ,CAAyBR,IAAI,CAACO,GAA9B,CAAmC,CAACJ,OAApC,EACKxB,IADL,CACU,SAAC8B,OAAD,CAAa,CACf;AACA,GAAMC,CAAAA,QAAQ,CAAGrD,KAAK,CAACsD,GAAN,CAAU,SAACC,CAAD,QAAQA,CAAAA,CAAC,CAACL,GAAF,GAAUP,IAAI,CAACO,GAAf,CAAqBE,OAArB,CAA+BG,CAAvC,EAAV,CAAjB,CACA;AACAtD,QAAQ,CAACoD,QAAD,CAAR,CACH,CANL,EAOK3B,KAPL,CAOW,SAACC,GAAD,QAASC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAT,EAPX,EAQH,CAED,QAAS6B,CAAAA,iBAAT,CAA2Bb,IAA3B,CAAgC,CAC5BpE,GAAG,CAACkF,UAAJ,CAAed,IAAI,CAACO,GAApB,EACK5B,IADL,CACU,SAAC8B,OAAD,CAAY,CACd,GAAMC,CAAAA,QAAQ,CAAGrD,KAAK,CAAC0D,MAAN,CAAa,SAACH,CAAD,QAC1BA,CAAAA,CAAC,CAACL,GAAF,GAAUP,IAAI,CAACO,GAAf,CAAqB,EAArB,CAA0BE,OADA,EAAb,CAAjB,CAGAnD,QAAQ,CAACoD,QAAD,CAAR,CACH,CANL,EAOK3B,KAPL,CAOW,SAACC,GAAD,QAASC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAT,EAPX,EAQH,CAED,QAASgC,CAAAA,gBAAT,OAAyC,IAAdzD,CAAAA,IAAc,OAAdA,IAAc,CAARC,KAAQ,OAARA,KAAQ,CACrC,MAAO5B,CAAAA,GAAG,CAACqF,WAAJ,CAAgB1D,IAAhB,CAAsBC,KAAtB,EACFmB,IADE,CACG,SAACuC,MAAD,CAAY,CACdxD,cAAc,CAACwD,MAAD,CAAd,CACAjB,cAAc,GACjB,CAJE,EAKFlB,KALE,CAKI,SAACC,GAAD,QAASC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAT,EALJ,CAAP,CAMH,CAED,QAASmC,CAAAA,kBAAT,CAA4BtC,IAA5B,CAAkC,CAC9BjD,GAAG,CAACwF,iBAAJ,CAAsBvC,IAAtB,EACKF,IADL,CACU,SAACuC,MAAD,CAAY,CACdxD,cAAc,CAACwD,MAAD,CAAd,CACAjB,cAAc,GACjB,CAJL,EAKKlB,KALL,CAKW,SAACC,GAAD,QAASC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAT,EALX,EAMH,CAED,QAASqC,CAAAA,oBAAT,OAA4C,IAAb9D,CAAAA,IAAa,OAAbA,IAAa,CAAP+D,IAAO,OAAPA,IAAO,CACxC1F,GAAG,CAAC2F,OAAJ,CAAYhE,IAAZ,CAAkB+D,IAAlB,EACK3C,IADL,CACU,SAAC8B,OAAD,CAAa,CACfnD,QAAQ,EAAEmD,OAAF,4BAAcpD,KAAd,GAAR,CACA4C,cAAc,GACjB,CAJL,EAKKlB,KALL,CAKW,SAACC,GAAD,QAASC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAT,EALX,EAMH,CAED;AACA,QAASwC,CAAAA,YAAT,CAAsBrD,KAAtB,CAA6BsD,QAA7B,CAAuC,CACnC5F,IAAI,CAAC6F,QAAL,CAAcvD,KAAd,CAAqBsD,QAArB,EAA+B9C,IAA/B,CAAoC,SAACC,GAAD,CAAS,CACzC,GAAGA,GAAG,CAAC+C,MAAJ,GAAe,GAAlB,CAAsB,CAClB7B,wBAAwB,CAAC,CAAC/B,QAAQ,CAAE6D,KAAX,CAAkB5D,IAAI,CAAE,gCAAxB,CAAD,CAAxB,CACA6B,0BAA0B,GAC1B;AACAgC,UAAU,CAACxD,OAAO,CAACS,IAAT,CAAe,IAAf,CAAqB,UAArB,CAAV,CACA+C,UAAU,CAAC5B,cAAD,CAAiB,IAAjB,CAAV,CACH,CACD,GAAGrB,GAAG,CAAC+C,MAAJ,GAAe,GAAlB,CAAuB,CACnB1C,OAAO,CAACC,GAAR,CAAY,kCAAZ,EACH,CACJ,CAXD,EAWGH,KAXH,CAWS,SAACC,GAAD,CAAQ,CACbc,wBAAwB,CAAC,CAAC/B,QAAQ,CAAE+D,OAAX,CAAoB9D,IAAI,CAAE,0CAA1B,CAAD,CAAxB,CACA6B,0BAA0B,GAC1BgC,UAAU,CAAC5B,cAAD,CAAiB,IAAjB,CAAV,CACAhB,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACH,CAhBD,EAiBH,CAED;AACA,QAAS+C,CAAAA,aAAT,CAAuB5D,KAAvB,CAA8BsD,QAA9B,CAAwC,CACpC5F,IAAI,CAACmG,SAAL,CAAe7D,KAAf,CAAsBsD,QAAtB,EACK9C,IADL,CACU,SAACE,IAAD,CAAU,CACZ,GAAI,CAACA,IAAL,CAAW,CACP,KAAM,IAAIoD,CAAAA,KAAJ,CAAU,kBAAV,CAAN,CACH,CACDpG,IAAI,CAAC6C,UAAL,CAAgBG,IAAhB,EACKF,IADL,CACU,SAACC,GAAD,CAAS,CACXR,QAAQ,CAACQ,GAAG,CAACC,IAAJ,CAASV,KAAV,CAAR,CACH,CAHL,EAGOY,KAHP,CAGa,SAAAC,GAAG,QAAIC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAJ,EAHhB,EAIAlB,WAAW,CAAC,IAAD,CAAX,CACAgC,wBAAwB,CAAC,CAAC/B,QAAQ,CAAE6D,KAAX,CAAkB5D,IAAI,CAAE,4BAAxB,CAAD,CAAxB,CACA6B,0BAA0B,GAC1B;AACAgC,UAAU,CAACxD,OAAO,CAACS,IAAT,CAAe,IAAf,CAAqB,GAArB,CAAV,CACA+C,UAAU,CAAC5B,cAAD,CAAiB,IAAjB,CAAV,CACH,CAfL,EAeOlB,KAfP,CAea,SAACC,GAAD,CAAS,CAClBc,wBAAwB,CAAC,CAAC/B,QAAQ,CAAE+D,OAAX,CAAoB9D,IAAI,CAAE,0CAA1B,CAAD,CAAxB,CACA6B,0BAA0B,GAC1BZ,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACH,CAnBD,EAoBH,CAED;AACA,QAASkD,CAAAA,aAAT,EAAyB,CACrBpE,WAAW,CAAC,KAAD,CAAX,CACAU,YAAY,CAAC2D,UAAb,CAAwB,KAAxB,EACA/D,QAAQ,CAAC,EAAD,CAAR,CACAC,OAAO,CAACS,IAAR,CAAa,UAAb,EACH,CAED,mBACJ,sCACI,MAAC,kBAAD,CAAoB,QAApB,EAA6B,KAAK,CAAErB,WAApC,wBACE,KAAC,MAAD,EAAQ,QAAQ,CAAEI,QAAlB,CAA4B,KAAK,CAAEM,KAAnC,CAA0C,aAAa,CAAE+D,aAAzD,EADF,cAEI,MAAC,MAAD,YACKzE,WAAW,eAAI,KAAC,cAAD,EACZ,KAAK,KADO,CACN,IAAI,CAAC,GADC,CAEZ,QAAQ,CAAEI,QAFE,CAGZ,SAAS,CAAEvC,IAHC,CAIZ,aAAa,CAAEoE,sBAJH,CAKZ,UAAU,CAAEC,mBALA,CAMZ,YAAY,CAAEC,qBANF,CAOZ,WAAW,CAAEG,eAPD,CAQZ,KAAK,CAAE1C,KARK,CASZ,UAAU,CAAE6C,eATA,CAUZ,YAAY,CAAEW,iBAVF,EADpB,cAaI,KAAC,KAAD,EAAO,IAAI,CAAC,UAAZ,uBACI,KAAC,KAAD,EACI,aAAa,CAAEkB,aADnB,EADJ,EAbJ,cAkBI,KAAC,KAAD,EAAO,IAAI,CAAC,UAAZ,uBACI,KAAC,QAAD,EACI,YAAY,CAAEP,YADlB,EADJ,EAlBJ,cAuBI,KAAC,KAAD,EAAO,IAAI,CAAC,GAAZ,UACK3D,QAAQ,cAAG,KAAC,QAAD,EAAU,EAAE,CAAC,GAAb,EAAH,cAAyB,KAAC,QAAD,EAAU,EAAE,CAAC,UAAb,EADtC,EAvBJ,GAFJ,CA6BKA,QAAQ,eAAI,KAAC,MAAD,IA7BjB,cA8BI,KAAC,gBAAD,EACI,MAAM,CAAEd,sBADZ,CAEI,OAAO,CAAEkD,cAFb,CAGI,YAAY,CAAEe,gBAHlB,EA9BJ,cAmCI,KAAC,eAAD,EACI,MAAM,CAAErE,qBADZ,CAEI,OAAO,CAAEsD,cAFb,CAGI,cAAc,CAAEkB,kBAHpB,EAnCJ,cAwCI,KAAC,aAAD,EACI,MAAM,CAAEtE,mBADZ,CAEI,OAAO,CAAEoD,cAFb,CAGI,UAAU,CAAEoB,oBAHhB,EAxCJ,cA8CM,KAAC,aAAD,EAAe,IAAI,CAAC,YAApB,CACe,KAAK,CAAC,0DADrB,CAEe,MAAM,CAAC,cAFtB,EA9CN,cAoDM,KAAC,UAAD,EACI,IAAI,CAAEpE,YADV,CAEI,MAAM,CAAEE,oBAFZ,CAGI,OAAO,CAAE8C,cAHb,EApDN,CA0DKxC,WAAW,eACZ,KAAC,WAAD,EACI,MAAM,CAAEE,sBADZ,CAEI,OAAO,CAAEsC,cAFb,CAGI,OAAO,CAAEhC,OAHb,EA3DJ,GADJ,EADI,CAsEH,CAED,cAAexB,CAAAA,GAAf","sourcesContent":["import '../index.css';\nimport Header from './Header.js';\nimport Main from './Main.js';\nimport Login from './Login.js';\nimport Register from './Register';\nimport PopupWithForm from './PopupWithForm.js';\nimport ImagePopup from './ImagePopup.js';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport api from '../utils/api.js';\nimport * as Auth from '../utils/auth';\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport InfoTooltip from \"./InfoToolTip\";\nimport React from \"react\";\nimport RegOk from '../images/registration-ok.svg';\nimport RegNoOK from '../images/login-fail.svg';\nimport { Route, Switch, Redirect, useHistory } from \"react-router-dom\";\nimport Footer from \"./Footer\";\n\n\nfunction App() {\n\n    const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n    const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n    const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n    const [selectedCard, setSelectedCard] = React.useState({});\n    const [isPopupWithImageOpen, setIsPopupWithImageOpen] = React.useState(false);\n    const [cards, setCards] = React.useState([]);\n    const [currentUser, setCurrentUser] = React.useState({ name: '', about: ''});\n    const [isInfoTooltipPopupOpen, setIsInfoTooltipPopupOpen] = React.useState(false);\n    const [loggedIn, setLoggedIn] = React.useState(false);\n    const [message, setMessage] = React.useState({ iconPath: '', text: '' });\n    const [email, setEmail] = React.useState('');\n    const history = useHistory();\n\n    React.useEffect(() => {\n        const jwt = localStorage.getItem('jwt');\n        if (jwt) {\n            Auth.getContent(jwt)\n                .then((res) => {\n                    setLoggedIn(true);\n                    setEmail(res.data.email);\n                    history.push('/');\n                })\n                .catch(err => console.log(err));\n        }\n    }, [history]);\n\n\n    React.useEffect(() => {\n        const promises = [api.getUserInfo(), api.getInitialCards()];\n        Promise.all(promises)\n            .then(([user, cards]) => {\n                console.log(user, cards)\n                setCurrentUser(user);\n                setCards(cards);\n            })\n            .catch((error) => {\n                console.log(error);\n            })\n    }, []);\n\n    function handleEditProfileClick() {\n        setIsEditProfilePopupOpen(true);\n    }\n\n    function handleAddPlaceClick(){\n        setIsAddPlacePopupOpen(true);\n    }\n\n    function handleEditAvatarClick() {\n        setIsEditAvatarPopupOpen(true);\n    }\n\n    function handleInfoTooltipPopupOpen() {\n        setIsInfoTooltipPopupOpen(true);\n    }\n    function handleInfoTooltipContent({iconPath, text}) {\n        setMessage({ iconPath: iconPath, text: text })\n    }\n\n    function handleCardClick(card) {\n        setSelectedCard(card);\n        setIsPopupWithImageOpen(true);\n    }\n\n    function closeAllPopups() {\n        setIsEditProfilePopupOpen(false);\n        setIsAddPlacePopupOpen(false);\n        setIsEditAvatarPopupOpen(false);\n        setSelectedCard({});\n        setIsPopupWithImageOpen(false);\n        setIsInfoTooltipPopupOpen(false);\n    }\n\n    function handleLikeClick(card) {\n        const isLiked = card.likes.some((i) => i._id === currentUser._id);\n        // Отправляем запрос в API и получаем обновлённые данные карточки\n        api.changeLikeCardStatus(card._id, !isLiked)\n            .then((newCard) => {\n                // Формируем новый массив на основе имеющегося, подставляя в него новую карточку\n                const newCards = cards.map((c) => (c._id === card._id ? newCard : c));\n                // Обновляем стейт\n                setCards(newCards);\n            })\n            .catch((err) => console.log(err));\n    }\n\n    function handleDeleteClick(card){\n        api.deleteCard(card._id)\n            .then((newCard)=> {\n                const newCards = cards.filter((c) =>\n                    c._id === card._id ? \"\" : newCard\n                );\n                setCards(newCards);\n            })\n            .catch((err) => console.log(err));\n    }\n\n    function handleUpdateUser({name, about}) {\n        return api.setUserInfo(name, about)\n            .then((result) => {\n                setCurrentUser(result);\n                closeAllPopups();\n            })\n            .catch((err) => console.log(err));\n    }\n\n    function handleUpdateAvatar(data) {\n        api.updateAvatarImage(data)\n            .then((result) => {\n                setCurrentUser(result);\n                closeAllPopups();\n            })\n            .catch((err) => console.log(err));\n    }\n\n    function handleAddPlaceSubmit({name, link}) {\n        api.addCard(name, link)\n            .then((newCard) => {\n                setCards([newCard, ...cards]);\n                closeAllPopups();\n            })\n            .catch((err) => console.log(err));\n    }\n\n    // Регистрация\n    function registration(email, password) {\n        Auth.register(email, password).then((res) => {\n            if(res.status === 201){\n                handleInfoTooltipContent({iconPath: RegOk, text: 'Вы успешно зарегистрировались!'})\n                handleInfoTooltipPopupOpen();\n                // Перенаправляем на страницу логина спустя 3сек и закрываем попап\n                setTimeout(history.push, 3000, \"/sign-in\");\n                setTimeout(closeAllPopups, 2500);\n            }\n            if(res.status === 400) {\n                console.log('Введный емейл ужезарегестрирован')\n            }\n        }).catch((err)=> {\n            handleInfoTooltipContent({iconPath: RegNoOK, text: 'Что-то пошло не так! Попробуйте ещё раз.'})\n            handleInfoTooltipPopupOpen();\n            setTimeout(closeAllPopups, 2500);\n            console.log(err)\n        })\n    }\n\n    // Авторизация\n    function authorization(email, password) {\n        Auth.authorize(email, password )\n            .then((data) => {\n                if (!data) {\n                    throw new Error('Произошла ошибка');\n                }\n                Auth.getContent(data)\n                    .then((res) => {\n                        setEmail(res.data.email);\n                    }).catch(err => console.log(err));\n                setLoggedIn(true);\n                handleInfoTooltipContent({iconPath: RegOk, text: 'Вы успешно авторизовались!'})\n                handleInfoTooltipPopupOpen();\n                // Перенаправляем на главную страницу спустя 3сек и закрываем попап\n                setTimeout(history.push, 3000, \"/\");\n                setTimeout(closeAllPopups, 2500);\n            }).catch((err) => {\n            handleInfoTooltipContent({iconPath: RegNoOK, text: 'Что то пошло не так! Попробуйте еще раз!'})\n            handleInfoTooltipPopupOpen();\n            console.log(err)\n        })\n    }\n\n    // Выход из учетки\n    function handleSignOut() {\n        setLoggedIn(false);\n        localStorage.removeItem('jwt');\n        setEmail('');\n        history.push('/sign-in');\n    }\n\n    return (\n<>\n    <CurrentUserContext.Provider value={currentUser}>\n      <Header loggedIn={loggedIn} email={email} handleSignOut={handleSignOut}/>\n        <Switch>\n            {currentUser && <ProtectedRoute\n                exact path=\"/\"\n                loggedIn={loggedIn}\n                component={Main}\n                onEditProfile={handleEditProfileClick}\n                onAddPlace={handleAddPlaceClick}\n                onEditAvatar={handleEditAvatarClick}\n                onCardClick={handleCardClick}\n                cards={cards}\n                onCardLike={handleLikeClick}\n                onCardDelete={handleDeleteClick}\n            />}\n            <Route path=\"/sign-in\">\n                <Login\n                    authorization={authorization}\n                />\n            </Route>\n            <Route path=\"/sign-up\">\n                <Register\n                    registration={registration}\n                />\n            </Route>\n            <Route path=\"/\">\n                {loggedIn ? <Redirect to=\"/\" /> : <Redirect to=\"/sign-in\" />}\n            </Route>\n        </Switch>\n        {loggedIn && <Footer />}\n        <EditProfilePopup\n            isOpen={isEditProfilePopupOpen}\n            onClose={closeAllPopups}\n            onUpdateUser={handleUpdateUser}\n        />\n        <EditAvatarPopup\n            isOpen={isEditAvatarPopupOpen}\n            onClose={closeAllPopups}\n            onUpdateAvatar={handleUpdateAvatar}\n        />\n        <AddPlacePopup\n            isOpen={isAddPlacePopupOpen}\n            onClose={closeAllPopups}\n            onAddPlace={handleAddPlaceSubmit}\n        />\n\n          <PopupWithForm name=\"agreePopup\"\n                         title=\"Вы уверены?\"\n                         button=\"Да\">\n          </PopupWithForm>\n\n\n          <ImagePopup\n              card={selectedCard}\n              isOpen={isPopupWithImageOpen}\n              onClose={closeAllPopups}\n          >\n          </ImagePopup>\n        {currentUser &&\n        <InfoTooltip\n            isOpen={isInfoTooltipPopupOpen}\n            onClose={closeAllPopups}\n            message={message}\n        />\n        }\n    </CurrentUserContext.Provider>\n</>\n  );\n}\n\nexport default App;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}